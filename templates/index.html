<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Live MCP Test - Web Interface</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
        }
        .container {
            max-width: 1200px;
        }
        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
        }
        .output-container {
            background: #1e1e1e;
            color: #fff;
            border-radius: 10px;
            max-height: 600px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.5;
        }
        .output-line {
            padding: 2px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .output-line:last-child {
            border-bottom: none;
        }
        .output-line.stdout {
            color: #4CAF50;
        }
        .output-line.stderr {
            color: #f44336;
        }
        .output-line.system {
            color: #2196F3;
        }
        .status-badge {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
        }
        .status-running {
            background: #ff9800;
            color: white;
        }
        .status-completed {
            background: #4CAF50;
            color: white;
        }
        .status-error {
            background: #f44336;
            color: white;
        }
        .input-group {
            margin-bottom: 20px;
        }
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            border-radius: 25px;
            padding: 10px 30px;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .btn-danger {
            border-radius: 25px;
            padding: 10px 30px;
        }
        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .connection-status {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }
        .title {
            text-align: center;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .execution-info {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }
        .spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid transparent;
            border-top: 2px solid #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="connection-status">
        <span id="connection-status" class="badge bg-secondary">
            <i class="fas fa-circle"></i> é€£æ¥ä¸­...
        </span>
    </div>

    <div class="container mt-5">
        <div class="title">
            <h1><i class="fas fa-rocket"></i> Space Live MCP Test</h1>
            <p class="lead">Gemini CLI Web Interface</p>
        </div>

        <div class="card">
            <div class="card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5 class="card-title">
                            <i class="fas fa-terminal"></i> å‘½ä»¤è¼¸å…¥
                        </h5>
                        
                        <div class="input-group">
                            <input type="text" id="userInput" class="form-control" 
                                   placeholder="è¼¸å…¥æ‚¨çš„æŒ‡ä»¤..." 
                                   onkeypress="handleKeyPress(event)">
                            <button class="btn btn-primary" id="executeBtn" onclick="executeCommand()">
                                <i class="fas fa-play"></i> åŸ·è¡Œ
                            </button>
                            <button class="btn btn-danger" id="stopBtn" onclick="stopExecution()" style="display: none;">
                                <i class="fas fa-stop"></i> åœæ­¢
                            </button>
                        </div>

                        <div id="executionInfo" class="execution-info">
                            <div class="d-flex justify-content-between align-items-center">
                                <span id="executionStatus" class="status-badge status-running">
                                    <span class="spinner"></span> åŸ·è¡Œä¸­...
                                </span>
                                <small id="executionTime" class="text-muted"></small>
                            </div>
                            <div class="mt-2">
                                <strong>è¼¸å…¥:</strong> <span id="executionInput"></span>
                            </div>
                            <div class="mt-1">
                                <strong>å‘½ä»¤:</strong> <span id="executionCommand"></span>
                            </div>
                        </div>

                        <div class="d-flex justify-content-between">
                            <button class="btn btn-outline-light btn-sm" onclick="clearOutput()">
                                <i class="fas fa-trash"></i> æ¸…é™¤è¼¸å‡º
                            </button>
                            <a href="/history" class="btn btn-outline-light btn-sm">
                                <i class="fas fa-history"></i> åŸ·è¡Œæ­·å²
                            </a>
                        </div>
                    </div>

                    <div class="col-md-6">
                        <h5 class="card-title">
                            <i class="fas fa-desktop"></i> å³æ™‚è¼¸å‡º
                        </h5>
                        
                        <div id="outputContainer" class="output-container p-3">
                            <div class="output-line system">
                                <i class="fas fa-info-circle"></i> ç­‰å¾…æŒ‡ä»¤è¼¸å…¥...
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        // WebSocket é€£æ¥
        const socket = io();
        
        let currentExecutionId = null;
        let isExecuting = false;

        // é€£æ¥ç‹€æ…‹ç®¡ç†
        socket.on('connect', function() {
            updateConnectionStatus('connected', 'bg-success');
            addSystemMessage('WebSocket é€£æ¥æˆåŠŸ');
        });

        socket.on('disconnect', function() {
            updateConnectionStatus('é€£æ¥ä¸­æ–·', 'bg-danger');
            addSystemMessage('WebSocket é€£æ¥ä¸­æ–·');
        });

        socket.on('connected', function(data) {
            addSystemMessage(data.message);
        });

        // åŸ·è¡Œç›¸é—œäº‹ä»¶
        socket.on('execution_started', function(data) {
            currentExecutionId = data.id;
            isExecuting = true;
            
            // æ›´æ–°åŸ·è¡Œä¿¡æ¯
            document.getElementById('executionInfo').style.display = 'block';
            document.getElementById('executionInput').textContent = data.user_input;
            document.getElementById('executionTime').textContent = data.timestamp;
            document.getElementById('executionStatus').className = 'status-badge status-running';
            document.getElementById('executionStatus').innerHTML = '<span class="spinner"></span> åŸ·è¡Œä¸­...';
            
            // ç¦ç”¨åŸ·è¡ŒæŒ‰éˆ•ï¼Œé¡¯ç¤ºåœæ­¢æŒ‰éˆ•
            document.getElementById('executeBtn').disabled = true;
            document.getElementById('stopBtn').style.display = 'inline-block';
            
            // æ¸…é™¤ä¹‹å‰çš„è¼¸å‡º
            clearOutput();
            addSystemMessage(`ğŸš€ é–‹å§‹åŸ·è¡Œ (ID: ${data.id})`);
        });

        socket.on('execution_progress', function(data) {
            if (data.id === currentExecutionId) {
                document.getElementById('executionCommand').textContent = data.message;
                addSystemMessage(data.message);
            }
        });

        socket.on('execution_output', function(data) {
            if (data.id === currentExecutionId) {
                addOutputLine(data.line, data.type);
            }
        });

        socket.on('execution_completed', function(data) {
            if (data.id === currentExecutionId) {
                isExecuting = false;
                
                // æ›´æ–°ç‹€æ…‹
                const statusEl = document.getElementById('executionStatus');
                if (data.success) {
                    statusEl.className = 'status-badge status-completed';
                    statusEl.innerHTML = '<i class="fas fa-check"></i> å®Œæˆ';
                    addSystemMessage(`âœ… åŸ·è¡Œå®Œæˆ (è¿”å›ç¢¼: ${data.return_code})`);
                } else {
                    statusEl.className = 'status-badge status-error';
                    statusEl.innerHTML = '<i class="fas fa-times"></i> å¤±æ•—';
                    addSystemMessage(`âŒ åŸ·è¡Œå¤±æ•— (è¿”å›ç¢¼: ${data.return_code})`);
                }
                
                // é‡æ–°å•Ÿç”¨åŸ·è¡ŒæŒ‰éˆ•ï¼Œéš±è—åœæ­¢æŒ‰éˆ•
                document.getElementById('executeBtn').disabled = false;
                document.getElementById('stopBtn').style.display = 'none';
                currentExecutionId = null;
            }
        });

        socket.on('execution_error', function(data) {
            if (data.id === currentExecutionId) {
                isExecuting = false;
                
                // æ›´æ–°ç‹€æ…‹
                document.getElementById('executionStatus').className = 'status-badge status-error';
                document.getElementById('executionStatus').innerHTML = '<i class="fas fa-times"></i> éŒ¯èª¤';
                
                addSystemMessage(`âŒ ${data.error}`);
                
                // é‡æ–°å•Ÿç”¨åŸ·è¡ŒæŒ‰éˆ•ï¼Œéš±è—åœæ­¢æŒ‰éˆ•
                document.getElementById('executeBtn').disabled = false;
                document.getElementById('stopBtn').style.display = 'none';
                currentExecutionId = null;
            }
        });

        socket.on('error', function(data) {
            addSystemMessage(`âŒ éŒ¯èª¤: ${data.message}`);
        });

        socket.on('execution_stopped', function(data) {
            if (data.id === currentExecutionId) {
                isExecuting = false;
                
                // æ›´æ–°ç‹€æ…‹
                document.getElementById('executionStatus').className = 'status-badge status-error';
                document.getElementById('executionStatus').innerHTML = '<i class="fas fa-stop-circle"></i> å·²åœæ­¢';
                
                addSystemMessage(`â¹ï¸ ${data.message}`);
                
                // é‡æ–°å•Ÿç”¨åŸ·è¡ŒæŒ‰éˆ•ï¼Œéš±è—åœæ­¢æŒ‰éˆ•ï¼Œæ¢å¾©åœæ­¢æŒ‰éˆ•ç‹€æ…‹
                document.getElementById('executeBtn').disabled = false;
                document.getElementById('stopBtn').disabled = false;
                document.getElementById('stopBtn').innerHTML = '<i class="fas fa-stop"></i> åœæ­¢';
                document.getElementById('stopBtn').style.display = 'none';
                currentExecutionId = null;
            }
        });

        // UI åŠŸèƒ½å‡½æ•¸
        function updateConnectionStatus(text, className) {
            const statusEl = document.getElementById('connection-status');
            statusEl.textContent = text;
            statusEl.className = `badge ${className}`;
        }

        function addSystemMessage(message) {
            const container = document.getElementById('outputContainer');
            const line = document.createElement('div');
            line.className = 'output-line system';
            line.innerHTML = `<i class="fas fa-info-circle"></i> ${message}`;
            container.appendChild(line);
            container.scrollTop = container.scrollHeight;
        }

        function addOutputLine(text, type) {
            const container = document.getElementById('outputContainer');
            const line = document.createElement('div');
            line.className = `output-line ${type}`;
            line.textContent = text;
            container.appendChild(line);
            container.scrollTop = container.scrollHeight;
        }

        function executeCommand() {
            const input = document.getElementById('userInput').value.trim();
            if (!input) {
                alert('è«‹è¼¸å…¥æŒ‡ä»¤');
                return;
            }
            
            if (isExecuting) {
                alert('ç³»çµ±æ­£åœ¨åŸ·è¡Œä¸­ï¼Œè«‹ç¨ç­‰...');
                return;
            }
            
            // ç™¼é€åŸ·è¡Œè«‹æ±‚
            socket.emit('execute_command', { input: input });
            
            // æ¸…ç©ºè¼¸å…¥æ¡†
            document.getElementById('userInput').value = '';
        }

        function stopExecution() {
            if (!isExecuting || !currentExecutionId) {
                alert('ç›®å‰æ²’æœ‰æ­£åœ¨åŸ·è¡Œçš„å‘½ä»¤');
                return;
            }
            
            // ç™¼é€åœæ­¢è«‹æ±‚
            socket.emit('stop_execution', { id: currentExecutionId });
            
            // ç«‹å³ç¦ç”¨åœæ­¢æŒ‰éˆ•
            document.getElementById('stopBtn').disabled = true;
            document.getElementById('stopBtn').innerHTML = '<i class="fas fa-spinner fa-spin"></i> åœæ­¢ä¸­...';
            
            addSystemMessage('â¹ï¸ æ­£åœ¨åœæ­¢åŸ·è¡Œ...');
        }

        function clearOutput() {
            const container = document.getElementById('outputContainer');
            container.innerHTML = '<div class="output-line system"><i class="fas fa-info-circle"></i> è¼¸å‡ºå·²æ¸…é™¤</div>';
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter') {
                executeCommand();
            }
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œèšç„¦è¼¸å…¥æ¡†
        window.addEventListener('load', function() {
            document.getElementById('userInput').focus();
        });
    </script>
</body>
</html> 